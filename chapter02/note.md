# 用LangChain快速构建基于“易速鲜花”本地知识库的智能问答系统

## 项目及实现框架

框架主要组成部分：

- 数据源：非结构化数据、半结构化数据、结构化数据、代码等
- 大模型应用：application，LMM APP：以大模型为逻辑引擎，生成所需的回答
- 用例：大模型生成的回答可以构建出QA/聊天机器人等系统

### 核心实现机制

1. Loading：文档加载器将文档加载为LangChain能够读取的形式
2. Splitting：文本分割器将文档切分为指定大小，指定的大小称为“文档块”或者“文档片”
3. Storage：将文档块以“嵌入”（embedding）的形式存储到“向量数据库（Vector）”中形成一个个嵌入块
4. Retrieval：应用程序从存储中检索分割后的文档
5. Output：把问题和相似的嵌入片传递给语言模型LLM，使用包含问题和检索到的分割的提示生成答案

## 数据的准备和载入

使用langchain的`document_loader`来加载各种格式的文本。

## 文本的分割

使用LangChain的`RecursiveCharacterTextSplitter`来切分文本，指定参数来切分大小。

## 向量数据库存储

使用向量数据库`qdrant`库来存储“词嵌入”，首先需要安装库：

```
uv add qdrant-client
```

词嵌入：

> 自然语言处理和机器学习中的一个概念，将文字或词语转换为一系列数字，通常是一个向量。

向量数据库：

> 向量数据库，也称为矢量数据库或者向量搜索引擎，是一种专门用于存储和搜索向量形式的数据的数据库。
> 在众多的机器学习和人工智能应用中，尤其是自然语言处理和图像识别这类涉及大量非结构化数据的领域，将数据转化为高维度的向量是常见的处理方式。
> 这些向量可能拥有数百甚至数千个维度，是对复杂的非结构化数据如文本、图像的一种数学表述，从而使这些数据能被机器理解和处理。
> 然而，传统的关系型数据库在存储和查询如此高维度和复杂性的向量数据时，往往面临着效率和性能的问题。
> 因此，向量数据库被设计出来以解决这一问题，它具备高效存储和处理高维向量数据的能力，从而更好地支持涉及非结构化数据处理的人工智能应用。

## 相关数据获取

在将数据转换为向量后，要获取相关数据，需要将问题也转换为向量，然后去向量数据库中进行查询和比较，提取最接近的信息。

向量之间的比较通常基于向量的距离或者相似度，在高维空间中，常用的向量距离或相似度计算方法有：欧式距离和余弦相似度

- 欧式距离：最直接的距离度量方式，在高维空间中，两个向量的欧式距离就是各个对应维度差的平方和的平方根
- 余弦相似度：度量向量之间方向的相似性，它的值在-1和1之间，值越接近1，表示两个向量的方向越相似

如何选择：

- 关心数量等大小差异时用欧式距离，关心文本等语义差异时使用余弦相似度。
- 欧式距离度量的是绝对距离，能够很好的反应出向量的绝对差异，适合在推荐系统中使用。余弦相似度度量的是方向的相似度，更关心的是两个向量的角度差异，而不是大小差异。 适用于处理文本数据或其他高维稀疏数据。

RetrievalQA链,是一个检索式问答模型，用于生成问题的答案。RetrievalQA链包含两个部分：

- LLM是大模型，负责回答问题
- retrieval：负责根据问题检索相关的文档，找到具体的嵌入片，这些嵌入片对应的文档片就会被当作知识和问题一起被传递给大模型。